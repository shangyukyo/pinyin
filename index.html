<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ‹¼éŸ³å¤§å†’é™© - æ‹¼è¯»å®éªŒå®¤ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');

        :root {
            --primary-bg: linear-gradient(180deg, #fdfcf0 0%, #e0f2fe 100%);
            --accent-color: #22c55e;
            --card-border: #4ade80;
        }

        .theme-forest {
            --primary-bg: linear-gradient(180deg, #fdfcf0 0%, #e0f2fe 100%);
            --accent-color: #22c55e;
            --card-border: #4ade80;
            --header-bg: rgba(255, 255, 255, 0.6);
        }

        .theme-space {
            --primary-bg: linear-gradient(180deg, #1e1b4b 0%, #312e81 100%);
            --accent-color: #818cf8;
            --card-border: #6366f1;
            --header-bg: rgba(30, 27, 75, 0.8);
        }

        .theme-candy {
            --primary-bg: linear-gradient(180deg, #fff1f2 0%, #fce7f3 100%);
            --accent-color: #fb7185;
            --card-border: #fda4af;
            --header-bg: rgba(255, 255, 255, 0.8);
        }

        body {
            font-family: 'ZCOOL KuaiLe', cursive;
            background: var(--primary-bg);
            background-attachment: fixed;
            transition: all 0.5s ease;
            touch-action: manipulation;
            user-select: none;
        }

        .dynamic-header {
            background: var(--header-bg);
            backdrop-filter: blur(10px);
        }

        .pet-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(15px);
            border: 4px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .theme-forest .pet-card { background: rgba(255, 255, 255, 0.7); }
        .theme-candy .pet-card { background: rgba(255, 255, 255, 0.6); }

        .pinyin-btn {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }

        .pinyin-btn:active {
            transform: scale(0.9);
        }

        .progress-bar {
            height: 12px;
            background: rgba(0,0,0,0.1);
            border-radius: 6px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.5);
        }

        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .theme-space .text-gray-800 { color: #f8fafc; }
        .theme-space .text-gray-700 { color: #e2e8f0; }
        .theme-space .text-gray-500 { color: #94a3b8; }
        .theme-space #lesson-box, .theme-space #lab-box { background-color: rgba(30, 41, 59, 0.8); }

        .lab-slot {
            width: 100px;
            height: 100px;
            border: 4px dashed rgba(0,0,0,0.1);
            border-radius: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            transition: all 0.3s;
        }
    </style>
</head>
<body class="theme-forest min-h-screen pb-20" id="main-body">

    <header class="p-4 flex justify-between items-center sticky top-0 z-50 dynamic-header border-b">
        <div class="flex items-center gap-2">
            <span id="header-logo" class="text-3xl">ğŸ¦•</span>
            <h1 id="header-title" class="text-xl font-bold text-green-600">æ‹¼éŸ³èŒå® ä¹å›­</h1>
        </div>
        <div class="flex items-center gap-2">
            <select onchange="changeTheme(this.value)" class="bg-white/50 border-none rounded-full px-2 py-1 text-xs focus:outline-none">
                <option value="forest">æ£®æ—ä¹å›­</option>
                <option value="space">æ˜Ÿé™…æ¢é™©</option>
                <option value="candy">ç³–æœä¸–ç•Œ</option>
            </select>
            <div class="bg-yellow-400 text-white px-2 py-1 rounded-full text-xs flex items-center shadow-sm">
                ğŸ <span id="energy-val" class="ml-1 font-bold">0</span>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 mt-6">
        <!-- æ‹¼è¯»å®éªŒå®¤ (æ–°åŠŸèƒ½) -->
        <section id="lab-box" class="bg-white rounded-[3rem] p-6 mb-8 shadow-xl border-b-8 border-yellow-400 transition-all duration-500 overflow-hidden">
            <div class="text-center mb-6">
                <h3 class="text-2xl font-bold text-gray-800 flex items-center justify-center gap-2">
                    ğŸ§ª æ‹¼è¯»å®éªŒå®¤ <span class="text-sm font-normal text-gray-400">(ç‚¹ç‚¹çœ‹)</span>
                </h3>
            </div>
            
            <div class="flex flex-col md:flex-row items-center justify-center gap-6 mb-8">
                <!-- å£°æ¯é€‰åŒº -->
                <div class="flex flex-col items-center gap-2">
                    <span class="text-xs text-gray-400">å£°æ¯ (Initial)</span>
                    <div id="slot-initial" class="lab-slot bg-blue-50 text-blue-500 border-blue-200">?</div>
                </div>
                
                <span class="text-4xl text-gray-300 animate-pulse">+</span>
                
                <!-- éŸµæ¯é€‰åŒº -->
                <div class="flex flex-col items-center gap-2">
                    <span class="text-xs text-gray-400">éŸµæ¯ (Final)</span>
                    <div id="slot-final" class="lab-slot bg-red-50 text-red-500 border-red-200">?</div>
                </div>

                <span class="text-4xl text-gray-300">=</span>

                <!-- ç»“æœåŒº -->
                <div class="flex flex-col items-center gap-2">
                    <span class="text-xs text-gray-400">éŸ³èŠ‚ (Syllable)</span>
                    <div id="slot-result" class="lab-slot bg-yellow-400 text-white border-white shadow-lg scale-110">?</div>
                </div>
            </div>

            <!-- é€‰æ‹©åˆ—è¡¨ -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-blue-50/50 p-3 rounded-2xl">
                    <div class="flex flex-wrap gap-2 justify-center" id="list-initials"></div>
                </div>
                <div class="bg-red-50/50 p-3 rounded-2xl">
                    <div class="flex flex-wrap gap-2 justify-center" id="list-finals"></div>
                </div>
            </div>
        </section>

        <!-- å® ç‰©è¿›åŒ–åŒº -->
        <section class="pet-card rounded-[2.5rem] p-6 mb-8 text-center relative overflow-hidden">
            <div class="relative z-10">
                <div id="pet-avatar" class="text-9xl mb-4 floating">ğŸ¥š</div>
                <h2 id="pet-title" class="text-2xl text-gray-700 mb-4">æ‹¼éŸ³èƒ½é‡è›‹</h2>
                <div class="progress-bar max-w-xs mx-auto mb-2 shadow-inner">
                    <div id="evo-fill" class="h-full bg-gradient-to-r from-yellow-400 to-orange-500 transition-all duration-500" style="width: 5%"></div>
                </div>
                <p id="evo-tip" class="text-xs text-gray-400">å†æ”¶é›† <span id="need-val">10</span> ä¸ªèƒ½é‡ï¼Œè›‹å°±è¦è£‚å¼€å•¦ï¼</p>
            </div>
            <div id="deco-1" class="absolute -bottom-4 -left-4 text-6xl opacity-10">ğŸŒ¿</div>
            <div id="deco-2" class="absolute top-4 -right-4 text-6xl opacity-10 rotate-12">â˜€ï¸</div>
        </section>

        <!-- é—¯å…³åœ°å›¾ -->
        <nav class="flex gap-4 overflow-x-auto no-scrollbar pb-6 px-2" id="map-rail"></nav>

        <!-- æ•™å­¦å†…å®¹åŒº -->
        <section id="lesson-box" class="bg-white rounded-[3rem] p-8 shadow-xl border-t-8 border-green-400 transition-colors duration-500">
            <div class="text-center mb-8">
                <h3 id="lesson-name" class="text-3xl font-bold text-gray-800">åŠ è½½ä¸­...</h3>
                <p class="text-gray-500 mt-1" id="lesson-desc">è·Ÿæˆ‘å¤§å£°è¯»ï¼Œæ‹’ç»æ´‹è…”æ´‹è°ƒï¼</p>
            </div>

            <div id="pinyin-grid" class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-10"></div>

            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="completeDay()" class="bg-green-500 hover:bg-green-600 text-white px-10 py-4 rounded-full text-xl shadow-lg transition transform active:scale-95">
                    ğŸ‰ æˆ‘å­¦ä¼šå•¦ï¼
                </button>
            </div>
        </section>
    </main>

    <div id="toast" class="fixed bottom-24 left-1/2 -translate-x-1/2 bg-black/70 text-white px-8 py-3 rounded-full opacity-0 transition-opacity pointer-events-none z-[100]">
        <span id="toast-text"></span>
    </div>

    <script>
        const themeConfigs = {
            forest: {
                logo: "ğŸ¦•",
                title: "æ‹¼éŸ³èŒå® ä¹å›­",
                accent: "text-green-600",
                border: "border-green-400",
                deco: ["ğŸŒ¿", "â˜€ï¸"],
                petStages: ['ğŸ¥š', 'ğŸ£', 'ğŸ¥', 'ğŸ¦–']
            },
            space: {
                logo: "ğŸš€",
                title: "æ‹¼éŸ³æ˜Ÿé™…æ¢é™©",
                accent: "text-indigo-400",
                border: "border-indigo-500",
                deco: ["ğŸª", "âœ¨"],
                petStages: ['â˜„ï¸', 'ğŸ›¸', 'ğŸ¤–', 'ğŸ‘½']
            },
            candy: {
                logo: "ğŸ­",
                title: "æ‹¼éŸ³ç³–æœä¸–ç•Œ",
                accent: "text-pink-500",
                border: "border-pink-300",
                deco: ["ğŸ§", "ğŸŒˆ"],
                petStages: ['ğŸ¬', 'ğŸ©', 'ğŸ¦', 'ğŸ¦„']
            }
        };

        const initials = ['b', 'p', 'm', 'f', 'd', 't', 'n', 'l'];
        const finals = ['a', 'o', 'e', 'i', 'u', 'Ã¼'];

        const pinyinAudioMap = {
            'a': 'å•Š', 'o': 'å–”', 'e': 'é¹…',
            'i': 'è¡£', 'u': 'å±‹', 'Ã¼': 'æ·¤',
            'b': 'æ’­', 'p': 'æ³¼', 'm': 'æ‘¸', 'f': 'ä½›',
            'd': 'å¾—', 't': 'ç‰¹', 'n': 'å‘¢', 'l': 'ä¹'
        };

        const lessons = {
            1: { title: "å•éŸµæ¯ a o e", items: [
                { c: 'a', m: 'å¼ å¤§å˜´å·´ å•Šå•Šå•Š', bg: 'bg-red-50', text: 'text-red-500' },
                { c: 'o', m: 'åœ†åœ†å˜´å·´ å–”å–”å–”', bg: 'bg-blue-50', text: 'text-blue-500' },
                { c: 'e', m: 'æ‰æ‰å˜´å·´ é¹…é¹…é¹…', bg: 'bg-green-50', text: 'text-green-500' }
            ]},
            2: { title: "å•éŸµæ¯ i u Ã¼", items: [
                { c: 'i', m: 'ç‰™é½¿å¯¹é½ è¡£è¡£è¡£', bg: 'bg-purple-50', text: 'text-purple-500' },
                { c: 'u', m: 'å˜´å·´çªå‡º å±‹å±‹å±‹', bg: 'bg-yellow-50', text: 'text-yellow-500' },
                { c: 'Ã¼', m: 'å¹èµ·ç¬›å­ æ·¤æ·¤æ·¤', bg: 'bg-cyan-50', text: 'text-cyan-500' }
            ]},
            3: { title: "å£°æ¯ b p m f", items: [
                { c: 'b', m: 'å¹¿æ’­å¹¿æ’­ æ’­æ’­æ’­', bg: 'bg-pink-50', text: 'text-pink-500' },
                { c: 'p', m: 'æ³¼æ°´æ³¼æ°´ æ³¼æ³¼æ³¼', bg: 'bg-indigo-50', text: 'text-indigo-500' },
                { c: 'm', m: 'ä¸¤ä¸ªé—¨æ´ æ‘¸æ‘¸æ‘¸', bg: 'bg-orange-50', text: 'text-orange-500' }
            ]}
        };

        let appState = { 
            day: 1, 
            energy: 0, 
            stage: 0, 
            theme: 'forest',
            selectedInitial: null,
            selectedFinal: null
        };

        function changeTheme(themeKey) {
            appState.theme = themeKey;
            const body = document.getElementById('main-body');
            if (!body) return;
            
            body.className = `theme-${themeKey} min-h-screen pb-20`;
            
            const config = themeConfigs[themeKey];
            document.getElementById('header-logo').innerText = config.logo;
            document.getElementById('header-title').innerText = config.title;
            document.getElementById('header-title').className = `text-xl font-bold ${config.accent}`;
            document.getElementById('deco-1').innerText = config.deco[0];
            document.getElementById('deco-2').innerText = config.deco[1];
            
            const lessonBox = document.getElementById('lesson-box');
            if (lessonBox) {
                lessonBox.style.borderTopColor = getComputedStyle(body).getPropertyValue('--card-border');
            }
            
            document.getElementById('pet-avatar').innerText = config.petStages[appState.stage];
            loadLesson(appState.day);
        }

        // åˆå§‹åŒ–å®éªŒå®¤é€‰æ‹©å™¨
        function initLab() {
            const initContainer = document.getElementById('list-initials');
            const finalContainer = document.getElementById('list-finals');
            
            initials.forEach(i => {
                const btn = document.createElement('button');
                btn.className = "w-10 h-10 bg-white shadow-sm rounded-xl text-blue-500 font-bold hover:bg-blue-100 transition-all pinyin-btn";
                btn.innerText = i;
                btn.onclick = () => selectPart('initial', i);
                initContainer.appendChild(btn);
            });

            finals.forEach(f => {
                const btn = document.createElement('button');
                btn.className = "w-10 h-10 bg-white shadow-sm rounded-xl text-red-500 font-bold hover:bg-red-100 transition-all pinyin-btn";
                btn.innerText = f;
                btn.onclick = () => selectPart('final', f);
                finalContainer.appendChild(btn);
            });
        }

        function selectPart(type, val) {
            if (type === 'initial') {
                appState.selectedInitial = val;
                document.getElementById('slot-initial').innerText = val;
                document.getElementById('slot-initial').classList.add('animate__animated', 'animate__pulse');
                setTimeout(() => document.getElementById('slot-initial').classList.remove('animate__animated', 'animate__pulse'), 500);
            } else {
                appState.selectedFinal = val;
                document.getElementById('slot-final').innerText = val;
                document.getElementById('slot-final').classList.add('animate__animated', 'animate__pulse');
                setTimeout(() => document.getElementById('slot-final').classList.remove('animate__animated', 'animate__pulse'), 500);
            }

            if (appState.selectedInitial && appState.selectedFinal) {
                const result = appState.selectedInitial + appState.selectedFinal;
                const resultSlot = document.getElementById('slot-result');
                resultSlot.innerText = result;
                resultSlot.classList.add('animate__animated', 'animate__tada');
                
                // æ‹¼è¯»å‘éŸ³é€»è¾‘
                playSynthesis(`${pinyinAudioMap[appState.selectedInitial]} --- ${pinyinAudioMap[appState.selectedFinal]} --- ${result}`);
                
                appState.energy += 2;
                updatePetUI();
                
                setTimeout(() => resultSlot.classList.remove('animate__animated', 'animate__tada'), 1000);
            }
        }

        function playSynthesis(text) {
            window.speechSynthesis.cancel();
            const utter = new SpeechSynthesisUtterance();
            utter.lang = 'zh-CN';
            utter.text = text;
            utter.rate = 0.7;
            utter.pitch = appState.theme === 'candy' ? 1.4 : 1.1;
            window.speechSynthesis.speak(utter);
        }

        function initMap() {
            const rail = document.getElementById('map-rail');
            if (!rail) return;
            rail.innerHTML = '';
            for (let i = 1; i <= 30; i++) {
                const node = document.createElement('div');
                const isCurrent = i === appState.day;
                const isPassed = i < appState.day;
                const accentColor = appState.theme === 'space' ? '#818cf8' : (appState.theme === 'candy' ? '#fb7185' : '#fbbf24');
                
                node.className = `flex-shrink-0 w-16 h-16 rounded-full border-4 flex items-center justify-center text-xl font-bold cursor-pointer transition-all ${isCurrent ? 'scale-110 shadow-lg' : (isPassed ? 'text-white' : 'bg-white border-gray-100 text-gray-200')}`;
                
                if (isCurrent) {
                    node.style.backgroundColor = accentColor;
                    node.style.borderColor = 'white';
                    node.style.color = 'white';
                } else if (isPassed) {
                    node.style.backgroundColor = '#4ade80';
                    node.style.borderColor = '#22c55e';
                }
                
                node.innerHTML = isPassed ? 'â­' : i;
                node.onclick = () => { if (i <= appState.day) loadLesson(i); };
                rail.appendChild(node);
            }
        }

        function loadLesson(day) {
            appState.day = day;
            const data = lessons[day] || lessons[1];
            const lessonNameEl = document.getElementById('lesson-name');
            if (lessonNameEl) lessonNameEl.innerText = data.title;
            
            const grid = document.getElementById('pinyin-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            data.items.forEach(item => {
                const card = document.createElement('div');
                const cardBg = appState.theme === 'space' ? 'bg-indigo-900/50' : item.bg;
                const cardText = appState.theme === 'space' ? 'text-indigo-200' : item.text;

                card.className = `${cardBg} pinyin-btn p-8 rounded-[2rem] text-center border-4 border-white shadow-sm`;
                card.onclick = () => {
                    playSynthesis(`${pinyinAudioMap[item.c]}ã€‚ ${pinyinAudioMap[item.c]}ã€‚ ${item.m.replace(/[a-zA-Z]/g, '')}`);
                    appState.energy += 1;
                    updatePetUI();
                };
                card.innerHTML = `<div class="text-8xl font-black ${cardText} mb-4">${item.c}</div><div class="bg-white/80 rounded-full py-2 px-4 text-sm font-bold text-gray-600 shadow-inner">${item.m}</div>`;
                grid.appendChild(card);
            });
            initMap();
        }

        function updatePetUI() {
            const energyValEl = document.getElementById('energy-val');
            if (energyValEl) energyValEl.innerText = appState.energy;
            
            const evoFillEl = document.getElementById('evo-fill');
            if (evoFillEl) {
                const progress = (appState.energy % 25) * 4;
                evoFillEl.style.width = `${progress}%`;
            }
            
            const needValEl = document.getElementById('need-val');
            if (needValEl) needValEl.innerText = Math.max(0, 25 - (appState.energy % 25));
            
            let nextStage = 0;
            if (appState.energy >= 25) nextStage = 1;
            if (appState.energy >= 60) nextStage = 2;
            if (appState.energy >= 120) nextStage = 3;
            
            if (nextStage > appState.stage) {
                appState.stage = nextStage;
                const avatar = document.getElementById('pet-avatar');
                if (avatar) {
                    const config = themeConfigs[appState.theme];
                    avatar.innerText = config.petStages[nextStage];
                    avatar.classList.add('animate__animated', 'animate__bounceIn');
                    setTimeout(() => avatar.classList.remove('animate__animated', 'animate__bounceIn'), 1000);
                }
            }
        }

        function completeDay() {
            appState.energy += 10;
            if (appState.day < 3) { appState.day++; loadLesson(appState.day); }
            updatePetUI();
            showToast("å¤ªæ£’äº†ï¼æ‹¼è¯»å°è¾¾äººï¼");
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            const ts = document.getElementById('toast-text');
            if (t && ts) {
                ts.innerText = msg;
                t.style.opacity = '1';
                setTimeout(() => t.style.opacity = '0', 2000);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            initLab();
            loadLesson(1);
        });
    </script>
</body>
</html>
